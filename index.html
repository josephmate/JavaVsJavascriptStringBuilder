<html>
    <head>
        <script src="experiment.js"></script>
        <script>
            function addRow(base, power, size, concatDuration, arrayJoinDuration, builderDuration) {
                var resultsTable = document.getElementById("results");
                var tableRow = document.createElement("tr");
                var powerCell = document.createElement("td");
                powerCell.innerText = base + "^" + power;
                tableRow.append(powerCell);
                var sizeCell = document.createElement("td");
                sizeCell.innerText = size;
                tableRow.append(sizeCell);
                var concatCell  = document.createElement("td");
                concatCell.innerText = concatDuration;
                tableRow.append(concatCell);
                var joinCell  = document.createElement("td");
                joinCell.innerText = arrayJoinDuration;
                tableRow.append(joinCell);
                resultsTable.appendChild(tableRow);
                var builderCell  = document.createElement("td");
                builderCell.innerText = builderDuration;
                tableRow.append(builderCell);
                resultsTable.appendChild(tableRow);
            }
            
            function runBrowserExperiment() {
                var baseInput = document.getElementById("base");
                var base = parseInt(baseInput.value);
                var powerLimitInput = document.getElementById("powerLimit");
                var powerLimit = parseInt(powerLimitInput.value);
                var results = runExperiment(base, powerLimit);
                results.forEach(function(result){
                    addRow(result.base, result.power, result.size,
                        result.concatDuration, result.arrayJoinDuration, result.builderDuration);
                });
            }
        </script>
    </head>
    <body>
        <p>Calculate results for up to
            <input id="base" type="text" value="2"> to the power of <input id="powerLimit" type="text" value="26"> concats.
            <button onclick="runBrowserExperiment()">Run!</button></p>
        <p>You might get a popup about the page being slow. You need to click wait. </p>
        <p>On Chrome Version 84.0.4147.89 (Official Build) (64-bit) I was able to do 2^26 before the browser ran out of memory. </p>
        <p>I even tried increasing the js heap limit and that did not help: https://bugs.chromium.org/p/v8/issues/detail?id=847 recommends opening chrome with  -args --js-flags="--max_old_space_size=8192"
            after experimenting with it a bit, the command will look like:
            "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" -args --js-flags="--max_old_space_size=8192" from a command prompt.
            You can confirm by opening developer tools console and running console.memory and your jsHeapSizeLimit should be larger than without the flag.
        </p>
        <p>On Firefox 78.0.2 (64-bit) I was also able to to do 2^27 before the browser ran out of memory.</p>
        <table id="results">
            <thead>
                <th># concats</th>
                <th># concats</th>
                <th>String conat</th>
                <th>Array.join</th>
                <th>StringBuilder</th>
            </thead>
        </table>
    </body>
</html>